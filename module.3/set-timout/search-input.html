<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debounced Search Demo</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Set Inter font for a modern look */
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-2xl bg-white shadow-2xl rounded-xl p-8 space-y-6">
      <h1 class="text-3xl font-extrabold text-indigo-700 border-b pb-2">
        Debounce Input Simulator
      </h1>
      <p class="text-gray-600">
        Type rapidly in the box below. The simulated "API Call" will only
        execute if you pause typing for 500ms. If you type again, the previous
        scheduled call is cancelled.
      </p>

      <!-- Input Field -->
      <div class="space-y-2">
        <label for="search-input" class="text-lg font-medium text-gray-700"
          >Start Typing:</label
        >
        <input
          type="text"
          id="search-input"
          placeholder="Search here..."
          onkeyup="handleInput(this.value)"
          class="w-full p-3 border-2 border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 shadow-sm"
        />
      </div>

      <!-- Live Status Area -->
      <div
        id="status-message"
        class="p-3 rounded-lg text-sm transition duration-300 min-h-[40px] bg-indigo-50 text-indigo-800 border border-indigo-200"
      >
        <span class="font-semibold">Status:</span> Waiting for input...
      </div>

      <!-- Simulated Results Area -->
      <div class="space-y-3">
        <h2 class="text-xl font-bold text-gray-800">Simulated Results</h2>
        <div
          id="results-container"
          class="p-4 bg-gray-100 rounded-lg min-h-[100px] border border-gray-200"
        >
          <!-- Results will appear here -->
          <p class="text-gray-500 italic">No search executed yet.</p>
        </div>
      </div>
    </div>

    <script>
      // --- Debounce Logic ---

      const DELAY = 500; // 500 milliseconds (0.5 second)
      // Global state variable to hold the timer ID (maintained by the closure)
      let searchTimerId = null;

      const statusElement = document.getElementById("status-message");
      const resultsElement = document.getElementById("results-container");
      let currentQuery = "";

      /**
       * The simulated resource-intensive function (runs only after debounce delay).
       */
      function simulateAPICall(query) {
        resultsElement.innerHTML = `
                <div class="text-green-700 font-semibold">
                    <span class="text-2xl">&#9989;</span> API CALL EXECUTED!
                </div>
                <p class="mt-1">
                    Fetching data for: <code class="bg-green-200 p-1 rounded font-mono">${query}</code>
                </p>
                <p class="text-sm text-gray-600 mt-2">
                    (This function ran because you paused typing for ${DELAY}ms.)
                </p>
            `;
        statusElement.className =
          "p-3 rounded-lg text-sm bg-green-100 text-green-800 border border-green-300";
        statusElement.innerHTML = `<span class="font-semibold">Status:</span> Search complete for "${query}".`;
        searchTimerId = null; // Reset the timer ID
      }

      /**
       * The core handler function (simulating the keyup/input event).
       * This function implements the debouncing logic.
       */
      function handleInput(query) {
        currentQuery = query;

        // 1. CANCELLATION: If a timer is already running, cancel the pending search.
        if (searchTimerId) {
          clearTimeout(searchTimerId);
          statusElement.className =
            "p-3 rounded-lg text-sm bg-yellow-100 text-yellow-800 border border-yellow-300";
          statusElement.innerHTML = `<span class="font-semibold">Status:</span> Scheduled search cancelled. Typing again...`;
        } else {
          statusElement.className =
            "p-3 rounded-lg text-sm bg-indigo-50 text-indigo-800 border border-indigo-200";
          statusElement.innerHTML = `<span class="font-semibold">Status:</span> Scheduling search in ${DELAY}ms...`;
        }

        if (query.length === 0) {
          statusElement.innerHTML = `<span class="font-semibold">Status:</span> Waiting for input...`;
          resultsElement.innerHTML = `<p class="text-gray-500 italic">No search executed yet.</p>`;
          return;
        }

        // 2. SCHEDULING: Schedule the new search to run after the delay.
        // 3. Store the new ID.
        console.log("key", currentQuery);
        searchTimerId = setTimeout(() => {
          console.log("call api", currentQuery);
          simulateAPICall(currentQuery);
        }, DELAY);
      }
    </script>
  </body>
</html>
